package components

import (
	"fmt"
	"github.com/asek-ll/aecc-server/internal/dao"
)

templ RecipesPage(filter string, recipes []*dao.Recipe) {
	@Page("Recipes") {
        <a href="/recipes/new">New recipe</a>
		@RecipesFilter(filter)
        <div id="recipes-result">
            @RecipesList(recipes)
        </div>
	}
}

templ RecipesFilter(filter string) {
	<div>
		<label>
			Filter
			<input
				id="filter"
				name="filter"
				value={ filter }
				hx-get="/recipes?view=list"
				hx-trigger="keyup changed delay:500ms"
				hx-target="#recipes-result"
				placeholder="Search..."
			/>
		</label>
	</div>
}

templ RecipesList(recipes []*dao.Recipe) {
	<section>
		<table>
			for _, recipe := range recipes {
				<tr>
					<td><a href={ templ.URL(fmt.Sprintf("/recipes/%d", recipe.ID)) }>{ recipe.Name }</a></td>
					<td>
						<div class="recipe">
							for _, row := range FormatIngredients(recipe) {
								<div class="recipe-row" style="display: flex">
									for _, item := range row {
										<div class="recipe-slot" style="width: 48px">
											if item != nil {
												@ItemIconByUID(item.ItemUID)
											}
										</div>
									}
								</div>
							}
						</div>
					</td>
					<td>
						<div class="grid">
							for _, item := range recipe.Results {
								@ItemIconByUID(item.ItemUID)
							}
						</div>
					</td>
				</tr>
			}
		</table>
	</section>
}
